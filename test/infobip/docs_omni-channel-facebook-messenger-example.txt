Node:
(type) c
(layer)0
	Element:body
			Node:
			(type) h1
			(layer)1
				Element:h1
					OMNI channel: Facebook example
					This page will describe simple methods which will allow You to send messages and retrieve message reports using the Facebook and SMS communication channels.
			Node:
			(type) c
			(layer)1
				Element:hr
					[block:callout] { "type": "warning", "title": "Prerequisites", "body": "To be able to send Facebook messages using Infobip platform you need to have configured the Facebook service. Please follow the [detailed instructions](doc:facebook-messenger-introduction) for service activation and configuration." } [/block] In the following examples we'll show you how to configure the Facebook Messenger - SMS OMNI failover scenario, send your first messages and retrieve message reports. There are three easy steps to follow: [block:callout] { "type": "info", "title": "Facebook Messenger - SMS OMNI process", "body": "1. Create an OMNI Scenario\n2. Send message using an OMNI scenario\n3. Get Delivery Reports" } [/block] Available methods: * [Create OMNI scenario](#create-an-omni-scenario) * [Send OMNI text message](#send-omni-text-message) * [Send OMNI message by using Facebook user key](#send-omni-message-by-using-facebook-user-key) * [Send rich OMNI message](#send-rich-omni-message) * [Get delivery reports](#get-delivery-reports) [block:api-header] { "type": "basic", "title": "Create an OMNI scenario" } [/block] The first step is to create an **OMNI scenario**. In the OMNI scenario configuration, you need to define the OMNI steps which will be sequentially executed. The key parameters are the **`channel`** and **`from`**, respectively identifying the communication channels and senders for each communication channel. For Facebook sender (**"channel": "FACEBOOK"** flow) You should use the Facebook application **`key`** obtained during the Facebook channel activation process. [block:code] { "codes": [ { "code": "POST /omni/1/scenarios HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{\n \"name\":\"My first Facebook-SMS scenario\",\n \"flow\": [\n {\n \"from\": \"FacebookApplicationKey\",\n \"channel\": \"FACEBOOK\"\n },\n {\n \"from\": \"InfoSMS\",\n \"channel\": \"SMS\"\n } \n ],\n \"default\": true\n}", "language": "json" } ] } [/block] Response [block:code] { "codes": [ { "code": "{\n \"key\": \"12CD1116DC7B451B2B7286412482CCC1\",\n \"name\":\"My first Facebook-SMS scenario\",\n \"flow\": [\n {\n \"from\": \"FacebookApplicationKey\",\n \"channel\": \"FACEBOOK\"\n },\n {\n \"from\": \"InfoSMS\",\n \"channel\": \"SMS\"\n } \n ],\n \"default\": true\n}", "language": "json" } ] } [/block] If successful, the response header HTTP status code will be `200 OK` and the scenario will be created, as shown in the example bellow. If you try to create the scenario without authorization, you will receive a `401 Unauthorized` error. The **`key`** parameter needs to be stored as it will be used when sending the OMNI message. [block:callout] { "type": "info", "title": "Info", "body": "More information about creating an OMNI scenario can be found at the following page: [Scenario: Create](doc:omni-create-scenario)." } [/block] [block:api-header] { "type": "post", "title": "Send OMNI text message" } [/block] Once You've created an OMNI scenario (identified by the **`key`** parameter) as described in the previous chapter, you are ready to send your OMNI messages through defined FACEBOOK and SMS communication channels. Firstly, the FACEBOOK message will be sent on the defined phoneNumber. If for some reason the message is rejected on the FACEBOOK platform, the message will be sent using the SMS communication channel. [block:callout] { "type": "warning", "title": "Facebook messenger phone number", "body": "To be able to send messages to Facebook Messenger users, using the phone number, certain guidelines provided by Facebook must be followed. Please check detailed [Facebook guidelines](https://developers.facebook.com/docs/messenger-platform/send-api-reference#phone_number)" } [/block] For sending OMNI messages, you can use the **advanced** API method. Detailed descriptions about the **advanced** API method can be found here: [OMNI: Send the advanced message](doc:omni-send-advanced-message). The parameters that should be set are the scenario key, phoneNumber and specific text for each communication channels, as shown below. [block:code] { "codes": [ { "code": "POST /omni/1/advanced HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{ \n\t\"scenarioKey\":\"CC9F01A5DC7BEE2C2B829D203482A654\", \n \"destinations\":[ \n \t{ \n \t\"to\":{\n \"phoneNumber\": \"41793026727\"\n }\n }\n ],\n \"facebook\": {\n \t\"text\": \"This Facebook message will be delivered both to the Facebook user page and Facebook messenger.\"\n },\n \"sms\": {\n \t\"text\": \"This is the SMS failover message\"\n }\n}", "language": "json" } ] } [/block] The response: [block:code] { "codes": [ { "code": "{ \n \"messages\":[ \n { \n \"to\":{\n \"phoneNumber\": \"41793026731\"\n },\n \"status\":{ \n \"groupId\":0,\n \"groupName\":\"ACCEPTED\",\n \"id\":0,\n \"name\":\"MESSAGE_ACCEPTED\",\n \"description\":\"Message accepted\"\n },\n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\"\n }\n ]\n}", "language": "json", "name": "200 OK" } ] } [/block] If successful, the response header HTTP status code will be `200 OK` and the message will be sent. If you try to send the message without authorization, you will receive a `401 Unauthorized` error. [block:api-header] { "type": "post", "title": "Send OMNI message by using Facebook user key" } [/block] The phone number is not the only way to identify the recipient of the message. In some cases, your user may be using one phone number for receiving SMS messages and the other which is registered on Facebook. If this is the case, specifying one recipient phone number is not enough. This is where `facebookUserKey` comes in handy. If Facebook User Key is specified, it will be used as primary destination address for the Facebook message. The `phoneNumber` will be used only as SMS destination. [block:callout] { "type": "warning", "title": "Facebook User Key", "body": "Each registered application user has a unique 'key' which can be used as Facebook messenger destination address. Learn how to access your user keys in [**User documentation**](/docs/facebook-messenger-user)." } [/block] Request example [block:code] { "codes": [ { "code": "POST /omni/1/advanced HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{ \n\t\"scenarioKey\":\"CC9F01A5DC7BEE2C2B829D203482A654\", \n \"destinations\":[ \n \t{ \n \t\"to\":{\n \"phoneNumber\": \"41793026727\",\n \"facebookUserKey\": \"9c29bd43-054b-4cfe-a1d4-0b37812b4ed3\"\n }\n }\n ],\n \"facebook\": {\n \t\"text\": \"This Facebook message will be delivered both to the Facebook user page and Facebook messenger.\"\n },\n \"sms\": {\n \t\"text\": \"This is the SMS failover message\"\n }\n}", "language": "json" } ] } [/block] The response [block:code] { "codes": [ { "code": "{ \n \"messages\":[ \n { \n \"to\":{\n \"phoneNumber\": \"41793026731\",\n \"facebookUserKey\": \"9c29bd43-054b-4cfe-a1d4-0b37812b4ed3\"\n },\n \"status\":{ \n \"groupId\":0,\n \"groupName\":\"ACCEPTED\",\n \"id\":0,\n \"name\":\"MESSAGE_ACCEPTED\",\n \"description\":\"Message accepted\"\n },\n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\"\n }\n ]\n}", "language": "json" } ] } [/block] [block:api-header] { "type": "post", "title": "Send rich OMNI message" } [/block] Besides the text message, the media file can also be sent over API. Before sending the message, you will need to upload your media to publicly accessible server and supply `url` of the file. According to supplied file type, Facebook will attempt to render media preview inside of the client chat application. Supported media types are: `IMAGE`, `AUDIO`, `VIDEO` and `FILE`. If `type` is defined, `url` of the file must also be included in the request. Image request example: [block:code] { "codes": [ { "code": "POST /omni/1/advanced HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{ \n\t\"scenarioKey\":\"CC9F01A5DC7BEE2C2B829D203482A654\", \n \"destinations\":[ \n \t{ \n \t\"to\":{\n \"phoneNumber\": \"41793026727\"\n }\n }\n ],\n \"facebook\": {\n \"type\": \"IMAGE\",\n \"url\": \"https://somedomain.com/images/image.jpg\"\n },\n \"sms\": {\n \t\"text\": \"This is the SMS failover message\"\n }\n}", "language": "json" } ] } [/block] Response: [block:code] { "codes": [ { "code": "{ \n \"messages\":[ \n { \n \"to\":{\n \"phoneNumber\": \"41793026731\"\n },\n \"status\":{ \n \"groupId\":0,\n \"groupName\":\"ACCEPTED\",\n \"id\":0,\n \"name\":\"MESSAGE_ACCEPTED\",\n \"description\":\"Message accepted\"\n },\n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\"\n }\n ]\n}", "language": "json" } ] } [/block] [block:api-header] { "type": "get", "title": "Get Delivery Reports" } [/block] Once you've successfully sent your message using the **advanced** API method you'll be able to check the status of sent messages using the [OMNI reports](doc:omni-reports) method. The simplest way is to use the method without any query parameters. In that case, the response will contain all the messages sent to a specific account. [block:code] { "codes": [ { "code": "GET /omni/1/reports HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nAccept: application/json", "language": "json" } ] } [/block] The response will contain all messages, rejected and delivered, as shown in the example below. [block:code] { "codes": [ { "code": "HTTP/1.1 200 OK\nContent-Type: application/json\n\n{ \n \"results\":[ \n { \n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\",\n \"to\":\"41793026731\",\n \"messageCount\": 1,\n \"sentAt\":\"2016-02-23T17:41:11.833+0100\",\n \"doneAt\":\"2016-02-23T17:41:11.843+0100\",\n \"mccMnc\":\"22801\",\n \"price\":{ \n \"pricePerMessage\":0.0104,\n \"currency\":\"EUR\"\n },\n \"status\":{ \n \"groupId\":2,\n \"groupName\":\"UNDELIVERABLE\",\n \"id\":9,\n \"name\":\"UNDELIVERABLE_NOT_DELIVERED\",\n \"description\":\"Message sent not delivered\"\n },\n \"error\":{ \n \"groupId\":1,\n \"groupName\":\"HANDSET_ERRORS\",\n \"id\":6,\n \"name\":\"EC_ABSENT_SUBSCRIBER_SM\",\n \"description\":\"Absent Subscriber\",\n \"permanent\":false\n },\n \"channel\": \"FACEBOOK\"\n },\n { \n \"messageId\":\"2315d543441c-335f-1d3d-142d31451ed25f35\",\n \"to\":\"41793026731\",\n \"sentAt\":\"2016-06-23T17:40:31.773+0100\",\n \"doneAt\":\"2016-06-23T17:40:31.787+0100\",\n \"messageCount\":1,\n \"mccMnc\":\"22801\",\n \"price\":{ \n \"pricePerMessage\":0.01,\n \"currency\":\"EUR\"\n },\n \"status\":{ \n \"groupId\":3,\n \"groupName\":\"DELIVERED\",\n \"id\":5,\n \"name\":\"DELIVERED_TO_HANDSET\",\n \"description\":\"Message delivered to handset\"\n },\n \"error\":{ \n \"groupId\":0,\n \"groupName\":\"OK\",\n \"id\":0,\n \"name\":\"NO_ERROR\",\n \"description\":\"No Error\",\n \"permanent\":false\n },\n \"channel\": \"SMS\"\n }\n ]\n}", "language": "json" } ] } [/block]
			Node:
			(type) c
			(layer)1
				Element:footer
			Node:
			(type) c
			(layer)1
												Node:
												(type) c
												(layer)4
													Element:h4
														Subscribe to our newsletter
												Node:
												(type) c
												(layer)4
													Element:noscript
												Node:
												(type) c
												(layer)4
													Element:noscript
