Node:
(type) c
(layer)0
	Element:body
			Node:
			(type) h1
			(layer)1
				Element:h1
					OMNI channel: Viber example
					This page will describe simple methods which will allow you to send messages and retrieve message reports using the Viber and SMS communication channels.
			Node:
			(type) c
			(layer)1
				Element:hr
					In the following examples, we'll show you how to configure the Viber-SMS failover scenario, send Your first messages and retrieve message reports. The messages will be firstly sent over Viber communication channel. If the messages are rejected on Viber (for example, the user does not have Viber installed), the messages will be sent using SMS communication channel. For each communication channel, a specific validity period can be set. There are three easy steps to follow: [block:callout] { "type": "warning", "title": "VIBER - SMS OMNI process", "body": "1. Create an OMNI Scenario\n2. Send message using an OMNI scenario\n3. Get Delivery Reports" } [/block] [block:api-header] { "type": "basic", "title": "1. Create OMNI scenario" } [/block] The first step is to create an **OMNI scenario**. In the OMNI scenario configuration, You need to define the OMNI steps which will be sequentially executed. The key parameters are the **`channel`** and **`from`**, respectively identifying the communication channels and senders for each communication channel. [block:callout] { "type": "info", "title": "Prerequisites", "body": "To be able to send Viber messages using Infobip platform you need to have configured the Viber service. Please [contact us](mailto:support@infobip.com) for service activation and configuration." } [/block] For Viber sender (**"channel": "VIBER"** flow) You should use the Viber sender provided during the activation process. [block:code] { "codes": [ { "code": "POST /omni/1/scenarios HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{\n \"name\":\"My VIBER-SMS scenario\",\n \"flow\": [\n {\n \"from\": \"ViberSender\",\n \"channel\": \"VIBER\"\n },\n {\n \"from\": \"InfoSMS\",\n \"channel\": \"SMS\"\n } \n ],\n \"default\": true\n}", "language": "json" } ] } [/block] # Response format If successful, the response header HTTP status code will be `200 OK` and the scenario will be created, as shown in the example bellow. If you try to create the scenario without authorization, you will receive a `401 Unauthorized` error. [block:code] { "codes": [ { "code": "{\n \"key\": \"CC9F01A5DC7BEE2C2B829D203482A654\",\n \"name\":\"My VIBER-SMS scenario\",\n \"flow\": [\n {\n \"from\": \"ViberSender\",\n \"channel\": \"VIBER\"\n },\n {\n \"from\": \"InfoSMS\",\n \"channel\": \"SMS\"\n } \n ],\n \"default\": true\n}", "language": "json" } ] } [/block] The **`key`** parameter needs to be stored as it will be used when sending the message. [block:callout] { "type": "info", "title": "Info", "body": "More information about creating an OMNI scenario can be found at the following page: [Scenario: Create](doc:omni-create-scenario) ." } [/block] [block:api-header] { "type": "post", "title": "2. Send OMNI message" } [/block] Once You've created an OMNI scenario (identified by the **`key`** parameter) as described in the previous chapter, you are ready to send your OMNI messages through defined VIBER and SMS communication channels. Firstly, the VIBER message will be sent on the defined phoneNumber. If, for some reason, the message is rejected on the VIBER application or the end user has not installed the Viber application, the message will be sent using the SMS communication channel. For sending OMNI messages, you can use the **advanced** API method. Detailed descriptions about the **advanced** API method can be found here: [OMNI: Send an advanced message](doc:omni-send-advanced-message). The parameters that should be set are the scenario key, phoneNumber and specific text for each communication channels, as shown in the below. [block:code] { "codes": [ { "code": "POST /omni/1/advanced HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{ \n\t\"scenarioKey\":\"CC9F01A5DC7BEE2C2B829D203482A654\", \n \"destinations\":[ \n \t{ \n \t\"to\":{\n \"phoneNumber\": \"41793026727\"\n }\n }\n ],\n \"viber\": {\n \t\"text\": \"This Viber message will be delivered to Viber application on the user device.\"\n },\n \"sms\": {\n \t\"text\": \"This is the SMS failover message\"\n }\n}", "language": "json" } ] } [/block] # Response format If successful, the response header HTTP status code will be `200 OK` and the message will be sent. If you try to send the message without authorization, you will receive a `401 Unauthorized` error. [block:code] { "codes": [ { "code": "HTTP/1.1 200 OK\nContent-Type: application/json\n\n{ \n \"messages\":[ \n { \n \"to\":{\n \"phoneNumber\": \"41793026731\"\n },\n \"status\":{ \n \"groupId\":0,\n \"groupName\":\"ACCEPTED\",\n \"id\":0,\n \"name\":\"MESSAGE_ACCEPTED\",\n \"description\":\"Message accepted\"\n },\n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\"\n }\n ]\n}", "language": "json", "name": "200 OK" } ] } [/block] [block:api-header] { "type": "get", "title": "3. Get Delivery Reports" } [/block] Once you've successfully sent your message using the **advanced** API method you can check the status of sent messages using the [OMNI reports](doc:omni-reports) method. The simplest way is to use the method without any query parameters. In that case, the response will contain all the messages sent to a specific account. [block:code] { "codes": [ { "code": "GET /omni/1/reports HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nAccept: application/json", "language": "json" } ] } [/block] The response will contain all messages, rejected and delivered, as shown in the example below. [block:code] { "codes": [ { "code": "HTTP/1.1 200 OK\nContent-Type: application/json\n\n{ \n \"results\":[ \n { \n \"messageId\":\"1215f543ab19-345f-adbd-12ad31451ed25f35\",\n \"to\":\"41793026731\",\n \"messageCount\": 1,\n \"sentAt\":\"2016-02-23T17:41:11.833+0100\",\n \"doneAt\":\"2016-02-23T17:41:11.843+0100\",\n \"mccMnc\":\"22801\",\n \"price\":{ \n \"pricePerMessage\":0.0104,\n \"currency\":\"EUR\"\n },\n \"status\":{ \n \"groupId\":2,\n \"groupName\":\"UNDELIVERABLE\",\n \"id\":9,\n \"name\":\"UNDELIVERABLE_NOT_DELIVERED\",\n \"description\":\"Message sent not delivered\"\n },\n \"error\":{ \n \"groupId\":1,\n \"groupName\":\"HANDSET_ERRORS\",\n \"id\":6,\n \"name\":\"EC_ABSENT_SUBSCRIBER_SM\",\n \"description\":\"Absent Subscriber\",\n \"permanent\":false\n },\n \"channel\": \"VIBER\"\n },\n { \n \"messageId\":\"2315d543441c-335f-1d3d-142d31451ed25f35\",\n \"to\":\"41793026731\",\n \"sentAt\":\"2016-06-23T17:40:31.773+0100\",\n \"doneAt\":\"2016-06-23T17:40:31.787+0100\",\n \"messageCount\":1,\n \"mccMnc\":\"22801\",\n \"price\":{ \n \"pricePerMessage\":0.01,\n \"currency\":\"EUR\"\n },\n \"status\":{ \n \"groupId\":3,\n \"groupName\":\"DELIVERED\",\n \"id\":5,\n \"name\":\"DELIVERED_TO_HANDSET\",\n \"description\":\"Message delivered to handset\"\n },\n \"error\":{ \n \"groupId\":0,\n \"groupName\":\"OK\",\n \"id\":0,\n \"name\":\"NO_ERROR\",\n \"description\":\"No Error\",\n \"permanent\":false\n },\n \"channel\": \"SMS\"\n }\n ]\n}", "language": "json" } ] } [/block] [block:api-header] { "type": "basic", "title": "Additional Examples" } [/block] [block:api-header] { "type": "post", "title": "Send Rich Viber message" } [/block] If you would like to send Viber messages containing text, images and CTA buttons please check the example provided below. The example also shows hot to configure custom validity period for each communication channel. [block:parameters] { "data": { "h-0": "Parameter", "h-1": "Type", "h-2": "Description", "0-1": "string", "0-0": "text", "1-0": "imageURL", "2-0": "buttonText", "3-0": "buttonURL", "1-1": "string", "2-1": "string", "3-1": "string", "4-0": "isPromotional", "4-1": "boolean", "4-2": "Indicates if content is of promotional character.", "3-2": "Viber Button Call To Action. Should point to your landing page.", "2-2": "Viber button label. Max 20 characters.", "1-2": "URL of the image sent in the Viber message.", "0-2": "Text of the message that will be sent. Max 1000 characters.", "5-0": "validityPeriod", "5-2": "The message validity period in minutes. When the period expires, the message will be automatically sent using the next OMNI step.", "5-1": "string" }, "cols": 3, "rows": 6 } [/block] [block:callout] { "type": "warning", "title": "Rich Viber message", "body": "When sending rich Viber message, `imageURL`, `buttonText` and `buttonURL` are all mandatory!" } [/block] [block:callout] { "type": "info", "title": "Info", "body": "Default validity period in OMNI for Viber messages is 24h and for SMS messages is 48h." } [/block] Rich Viber message request example [block:code] { "codes": [ { "code": "POST /omni/1/advanced HTTP/1.1\nHost: api.infobip.com\nAuthorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==\nContent-Type: application/json\n\n{ \n\t\"scenarioKey\":\"CC9F01A5DC7BEE2C2B829D203482A654\", \n \"destinations\":[ \n \t{ \n \t\"to\":{\n \"phoneNumber\": \"41793026727\"\n }\n }\n ],\n \"viber\": {\n \"text\": \"This is the message which will be displayed in Viber Application. It can contain up to 1000 characters. \",\n \"imageURL\": \"http://www.infobip.com/infobip-logo.png\",\n \"buttonText\": \"More information\",\n \"buttonURL\": \"http://www.infobip.com/\",\n \"isPromotional\": true,\n \"validityPeriod\":1\n },\n \"sms\": {\n \"text\": \"This text will be received via SMS if Viber message is not delivered.\",\n \"validityPeriod\":1\n }\n}", "language": "json" } ] } [/block] The message received in the Viber application is shown below: [block:image] { "images": [ { "image": [ "https://files.readme.io/0a7d82a-vibermsg.png", "vibermsg.png", 750, 1334, "#87c2de" ] } ] } [/block] If you have any additional questions please contact us at [contact us](mailto:support@infobip.com).
			Node:
			(type) c
			(layer)1
				Element:footer
			Node:
			(type) c
			(layer)1
												Node:
												(type) c
												(layer)4
													Element:h4
														Subscribe to our newsletter
												Node:
												(type) c
												(layer)4
													Element:noscript
												Node:
												(type) c
												(layer)4
													Element:noscript
